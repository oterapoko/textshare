<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TextShare - Test Page</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold mb-6">TextShare - Functionality Test</h1>
    
    <div class="bg-white p-6 rounded-lg shadow mb-6">
      <h2 class="text-xl font-semibold mb-4">üß™ Test Results</h2>
      <div id="test-results" class="space-y-2">
        <!-- Test results will be populated here -->
      </div>
      <button id="run-tests" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        Run Tests
      </button>
    </div>
    
    <div class="bg-white p-6 rounded-lg shadow">
      <h2 class="text-xl font-semibold mb-4">üìã Manual Testing Checklist</h2>
      <div class="space-y-2">
        <label class="flex items-center">
          <input type="checkbox" class="mr-2"> Landing page loads correctly
        </label>
        <label class="flex items-center">
          <input type="checkbox" class="mr-2"> "Create New Document" button works
        </label>
        <label class="flex items-center">
          <input type="checkbox" class="mr-2"> Room URL is generated with correct format
        </label>
        <label class="flex items-center">
          <input type="checkbox" class="mr-2"> Editor interface appears
        </label>
        <label class="flex items-center">
          <input type="checkbox" class="mr-2"> Text can be typed in editor
        </label>
        <label class="flex items-center">
          <input type="checkbox" class="mr-2"> Character count updates
        </label>
        <label class="flex items-center">
          <input type="checkbox" class="mr-2"> Copy link button works
        </label>
        <label class="flex items-center">
          <input type="checkbox" class="mr-2"> Connection status shows
        </label>
        <label class="flex items-center">
          <input type="checkbox" class="mr-2"> Text persists on page refresh
        </label>
        <label class="flex items-center">
          <input type="checkbox" class="mr-2"> Multiple tabs can sync (open same room in 2 tabs)
        </label>
      </div>
    </div>
    
    <div class="mt-6 text-center">
      <a href="/" class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 inline-block">
        Go to TextShare App
      </a>
    </div>
  </div>

  <script type="module">
    // Import the same modules to test them
    import * as Y from 'https://cdn.jsdelivr.net/npm/yjs@latest/+esm';
    import { WebrtcProvider } from 'https://cdn.jsdelivr.net/npm/y-webrtc@latest/+esm';
    import { IndexeddbPersistence } from 'https://cdn.jsdelivr.net/npm/y-indexeddb@latest/+esm';
    
    function addTestResult(name, passed, details = '') {
      const container = document.getElementById('test-results');
      const div = document.createElement('div');
      div.className = `p-3 rounded ${passed ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`;
      div.innerHTML = `
        <div class="flex items-center">
          <span class="mr-2">${passed ? '‚úÖ' : '‚ùå'}</span>
          <span class="font-medium">${name}</span>
        </div>
        ${details ? `<div class="text-sm mt-1 ml-6">${details}</div>` : ''}
      `;
      container.appendChild(div);
    }
    
    async function runTests() {
      const container = document.getElementById('test-results');
      container.innerHTML = '<div class="text-gray-600">Running tests...</div>';
      
      // Test 1: Yjs import
      try {
        const doc = new Y.Doc();
        addTestResult('Yjs Library Import', true, 'Y.Doc created successfully');
      } catch (e) {
        addTestResult('Yjs Library Import', false, e.message);
      }
      
      // Test 2: WebRTC Provider import
      try {
        const doc = new Y.Doc();
        const provider = new WebrtcProvider('test-room', doc, {
          signaling: ['wss://signaling.yjs.dev']
        });
        addTestResult('WebRTC Provider Import', true, 'WebrtcProvider created successfully');
        provider.destroy();
      } catch (e) {
        addTestResult('WebRTC Provider Import', false, e.message);
      }
      
      // Test 3: IndexedDB Provider import
      try {
        const doc = new Y.Doc();
        const provider = new IndexeddbPersistence('test-db', doc);
        addTestResult('IndexedDB Provider Import', true, 'IndexeddbPersistence created successfully');
      } catch (e) {
        addTestResult('IndexedDB Provider Import', false, e.message);
      }
      
      // Test 4: Room ID generation (from app.js)
      try {
        function generateRoomId() {
          const array = new Uint8Array(16);
          crypto.getRandomValues(array);
          return Array.from(array, byte => 
            byte.toString(16).padStart(2, '0')
          ).join('').substring(0, 12);
        }
        
        const roomId = generateRoomId();
        const isValid = /^[a-f0-9]{12}$/i.test(roomId);
        addTestResult('Room ID Generation', isValid, `Generated: ${roomId}`);
      } catch (e) {
        addTestResult('Room ID Generation', false, e.message);
      }
      
      // Test 5: Clipboard API
      try {
        const hasClipboard = !!navigator.clipboard;
        addTestResult('Clipboard API Support', hasClipboard, hasClipboard ? 'Available' : 'Not available (fallback will be used)');
      } catch (e) {
        addTestResult('Clipboard API Support', false, e.message);
      }
      
      // Test 6: WebRTC Support
      try {
        const hasWebRTC = !!(window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection);
        addTestResult('WebRTC Support', hasWebRTC, hasWebRTC ? 'Available' : 'Not supported in this browser');
      } catch (e) {
        addTestResult('WebRTC Support', false, e.message);
      }
      
      // Test 7: IndexedDB Support
      try {
        const hasIndexedDB = !!window.indexedDB;
        addTestResult('IndexedDB Support', hasIndexedDB, hasIndexedDB ? 'Available' : 'Not supported');
      } catch (e) {
        addTestResult('IndexedDB Support', false, e.message);
      }
      
      addTestResult('All Tests Complete', true, 'Check individual results above');
    }
    
    document.getElementById('run-tests').addEventListener('click', runTests);
    
    // Auto-run tests on load
    setTimeout(runTests, 500);
  </script>
</body>
</html>
