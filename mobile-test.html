<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TextShare - Mobile Test</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-2xl mx-auto">
    <h1 class="text-xl font-bold mb-4">üì± TextShare - Mobile Test</h1>
    
    <div class="bg-white p-4 rounded-lg shadow mb-4">
      <h2 class="font-semibold mb-2">üîß Persistence Test</h2>
      <p class="text-sm text-gray-600 mb-3">
        This tests if text saves properly on mobile browsers (especially Android Edge).
      </p>
      <div class="space-y-2">
        <button id="test-persistence" class="w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
          Test Text Persistence
        </button>
        <div id="persistence-result" class="text-sm p-2 bg-gray-100 rounded hidden">
          <!-- Results will appear here -->
        </div>
      </div>
    </div>
    
    <div class="bg-white p-4 rounded-lg shadow mb-4">
      <h2 class="font-semibold mb-2">üîÑ Multi-Tab Test</h2>
      <p class="text-sm text-gray-600 mb-3">
        This tests BroadcastChannel sync between tabs.
      </p>
      <div class="space-y-2">
        <button id="open-sync-test" class="w-full px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
          Open Sync Test Room
        </button>
        <p class="text-xs text-gray-500">
          Open the same room in another tab and type to test sync.
        </p>
      </div>
    </div>
    
    <div class="bg-white p-4 rounded-lg shadow mb-4">
      <h2 class="font-semibold mb-2">üìä Browser Support</h2>
      <div class="text-sm space-y-1">
        <div class="flex justify-between">
          <span>localStorage:</span>
          <span id="localstorage-support" class="font-mono">Checking...</span>
        </div>
        <div class="flex justify-between">
          <span>IndexedDB:</span>
          <span id="indexeddb-support" class="font-mono">Checking...</span>
        </div>
        <div class="flex justify-between">
          <span>BroadcastChannel:</span>
          <span id="broadcast-support" class="font-mono">Checking...</span>
        </div>
        <div class="flex justify-between">
          <span>WebRTC:</span>
          <span id="webrtc-support" class="font-mono">Checking...</span>
        </div>
      </div>
    </div>
    
    <div class="bg-white p-4 rounded-lg shadow">
      <h2 class="font-semibold mb-2">üìù Expected Results</h2>
      <div class="text-sm space-y-1">
        <div class="flex items-center">
          <span class="w-4 h-4 bg-green-500 rounded mr-2"></span>
          <span>Text persistence should work (localStorage fallback)</span>
        </div>
        <div class="flex items-center">
          <span class="w-4 h-4 bg-green-500 rounded mr-2"></span>
          <span>Same-device multi-tab sync should work</span>
        </div>
        <div class="flex items-center">
          <span class="w-4 h-4 bg-yellow-500 rounded mr-2"></span>
          <span>WebRTC may not work (signaling servers down)</span>
        </div>
        <div class="flex items-center">
          <span class="w-4 h-4 bg-green-500 rounded mr-2"></span>
          <span>App should work in "local-only" mode</span>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    // Check browser support
    function checkSupport() {
      document.getElementById('localstorage-support').textContent = 
        typeof Storage !== 'undefined' ? '‚úÖ Supported' : '‚ùå Not supported';
      
      document.getElementById('indexeddb-support').textContent = 
        window.indexedDB ? '‚úÖ Supported' : '‚ùå Not supported';
      
      document.getElementById('broadcast-support').textContent = 
        window.BroadcastChannel ? '‚úÖ Supported' : '‚ùå Not supported';
      
      document.getElementById('webrtc-support').textContent = 
        window.RTCPeerConnection ? '‚úÖ Supported' : '‚ùå Not supported';
    }
    
    // Test persistence
    document.getElementById('test-persistence').addEventListener('click', () => {
      const testKey = 'textshare-test-' + Date.now();
      const testData = 'Test data: ' + new Date().toISOString();
      const resultDiv = document.getElementById('persistence-result');
      
      try {
        // Test localStorage
        localStorage.setItem(testKey, testData);
        const retrieved = localStorage.getItem(testKey);
        
        if (retrieved === testData) {
          resultDiv.className = 'text-sm p-2 bg-green-100 text-green-800 rounded';
          resultDiv.textContent = '‚úÖ localStorage persistence works!';
        } else {
          resultDiv.className = 'text-sm p-2 bg-red-100 text-red-800 rounded';
          resultDiv.textContent = '‚ùå localStorage persistence failed';
        }
        
        // Clean up
        localStorage.removeItem(testKey);
        
      } catch (error) {
        resultDiv.className = 'text-sm p-2 bg-red-100 text-red-800 rounded';
        resultDiv.textContent = '‚ùå localStorage error: ' + error.message;
      }
      
      resultDiv.classList.remove('hidden');
    });
    
    // Open sync test
    document.getElementById('open-sync-test').addEventListener('click', () => {
      const testRoomId = 'mobile-test-' + Math.random().toString(36).substr(2, 6);
      const url = window.location.href.replace('mobile-test.html', '') + '#room-' + testRoomId;
      console.log('Opening sync test room:', url);
      window.open(url, '_blank');
    });
    
    // Initialize
    checkSupport();
    console.log('Mobile test page loaded');
    console.log('User agent:', navigator.userAgent);
  </script>
</body>
</html>
